<!DOCTYPE html>
<html>
<head>
    <title>Disposal Table Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Disposal Table Test</h1>
        <button onclick="testDisposalTable()" class="btn btn-primary">Test Disposal Table</button>
        
        <div class="mt-4">
            <h3>Disposals (<span id="disposals-count">0</span>)</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Symbol</th>
                        <th>Quantity</th>
                        <th>Proceeds</th>
                        <th>Cost Basis</th>
                        <th>Gain/Loss</th>
                    </tr>
                </thead>
                <tbody id="disposals-table-body">
                    <tr><td colspan="6" class="text-center text-muted">Click test button to load data</td></tr>
                </tbody>
            </table>
        </div>
        
        <div id="debug-info" class="mt-4"></div>
    </div>

    <script src="js/results.js"></script>
    <script>
        function testDisposalTable() {
            // Test data from our good API response
            const testData = {
                "tax_analysis": {
                    "capital_gains": {
                        "disposals": [
                            {
                                "security": {"symbol": "RR.", "name": "ROLLS-ROYCE HOLDINGS PLC"},
                                "sell_date": "2024-05-21 03:20:09",
                                "quantity": 100.0,
                                "proceeds": 435.0,
                                "cost_basis": 438.5,
                                "gain_or_loss": -6.1925
                            },
                            {
                                "security": {"symbol": "NXE", "name": "NEXGEN ENERGY LTD"},
                                "sell_date": "2024-10-21 11:47:58", 
                                "quantity": 130.0,
                                "proceeds": 615.4006447412011,
                                "cost_basis": 632.693612928,
                                "gain_or_loss": -17.930068186798893
                            },
                            {
                                "security": {"symbol": "AMZN", "name": "AMAZON.COM INC"},
                                "sell_date": "2024-11-01 13:06:03",
                                "quantity": 10.0,
                                "proceeds": 1184.804651236218,
                                "cost_basis": 1204.6389498879998,
                                "gain_or_loss": -20.472298651781807
                            }
                        ]
                    }
                }
            };
            
            console.log('Testing disposal table with data:', testData);
            
            try {
                // Initialize ResultsManager with test data
                const resultsManager = new ResultsManager(testData);
                
                document.getElementById('debug-info').innerHTML = `
                    <h4>Debug Info</h4>
                    <p><strong>Normalized disposals:</strong> ${resultsManager.normalized.disposals.length}</p>
                    <p><strong>First disposal symbol:</strong> ${resultsManager.normalized.disposals[0]?.security?.symbol}</p>
                    <p><strong>Table body found:</strong> ${!!document.getElementById('disposals-table-body')}</p>
                `;
                
            } catch (error) {
                console.error('Error testing disposal table:', error);
                document.getElementById('debug-info').innerHTML = `<p class="text-danger">Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>